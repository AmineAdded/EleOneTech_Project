<div class="forgot-container">
  <div class="forgot-background">
    <div class="bg-pattern"></div>
  </div>

  <div class="forgot-content">
    <div class="forgot-card">
      <!-- Back button -->
      <button class="back-btn" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Retour
      </button>

      <!-- Logo -->
      <div class="forgot-logo">
        <div class="logo-circle">
          <svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(40, 40)">
              <circle cx="0" cy="-15" r="8" fill="#f4c2d1"/>
              <circle cx="15" cy="0" r="8" fill="#f4c2d1"/>
              <circle cx="0" cy="15" r="8" fill="#f4c2d1"/>
              <circle cx="-15" cy="0" r="8" fill="#f4c2d1"/>
              <circle cx="10" cy="-10" r="6" fill="#e6a3b8"/>
              <circle cx="10" cy="10" r="6" fill="#e6a3b8"/>
              <circle cx="-10" cy="10" r="6" fill="#e6a3b8"/>
              <circle cx="-10" cy="-10" r="6" fill="#e6a3b8"/>
              <circle cx="0" cy="0" r="8" fill="#d4a574"/>
              <circle cx="0" cy="0" r="5" fill="#e8c99f"/>
            </g>
          </svg>
        </div>
      </div>

      <!-- Step 1: Email -->
      <div *ngIf="currentStep() === 'email'">
        <h2 class="forgot-title">Mot de passe oublié?</h2>
        <p class="forgot-description">
          Entrez votre adresse email et nous vous enverrons un code de vérification à 6 chiffres.
        </p>

        <div *ngIf="errorMessage()" class="error-message">
          {{ errorMessage() }}
        </div>

        <form class="forgot-form" (ngSubmit)="handleSendOtp()">
          <div class="form-group">
            <label for="email">Email</label>
            <input
              type="email"
              id="email"
              [(ngModel)]="email"
              name="email"
              placeholder="votre@email.com"
              required
              [disabled]="isLoading()">
          </div>

          <button type="submit" class="submit-btn" [disabled]="isLoading()">
            <span *ngIf="!isLoading()">Envoyer le code</span>
            <span *ngIf="isLoading()">Envoi en cours...</span>
          </button>
        </form>
      </div>

      <!-- Step 2: OTP Verification -->
      <div *ngIf="currentStep() === 'otp'">
        <h2 class="forgot-title">Vérification</h2>
        <p class="forgot-description">
          Entrez le code à 6 chiffres envoyé à <strong>{{ email }}</strong>
        </p>

        <div *ngIf="errorMessage()" class="error-message">
          {{ errorMessage() }}
        </div>

        <form class="forgot-form" (ngSubmit)="handleVerifyOtp()">
          <div class="otp-container">
            <input
              *ngFor="let digit of otpCode; let i = index"
              type="text"
              maxlength="1"
              class="otp-input"
              [(ngModel)]="otpCode[i]"
              [name]="'otp' + i"
              (input)="onOtpInput($event, i)"
              (keydown)="onOtpKeyDown($event, i)"
              (paste)="i === 0 ? onOtpPaste($event) : null"
              pattern="[0-9]"
              required
              [disabled]="isLoading()">
          </div>

          <button type="submit" class="submit-btn" [disabled]="isLoading()">
            <span *ngIf="!isLoading()">Vérifier le code</span>
            <span *ngIf="isLoading()">Vérification...</span>
          </button>

          <button type="button" class="link-btn" (click)="resendOtp()" [disabled]="isLoading()">
            Renvoyer le code
          </button>
        </form>
      </div>

      <!-- Step 3: New Password -->
      <div *ngIf="currentStep() === 'password'">
        <h2 class="forgot-title">Nouveau mot de passe</h2>
        <p class="forgot-description">
          Choisissez un nouveau mot de passe sécurisé
        </p>

        <div *ngIf="errorMessage()" class="error-message">
          {{ errorMessage() }}
        </div>

        <form class="forgot-form" (ngSubmit)="handleResetPassword()">
          <div class="form-group">
            <label for="newPassword">Nouveau mot de passe</label>
            <div class="input-wrapper">
              <input
                [type]="showPassword() ? 'text' : 'password'"
                id="newPassword"
                [(ngModel)]="newPassword"
                name="newPassword"
                placeholder="Minimum 6 caractères"
                required
                [disabled]="isLoading()">
              <button
                type="button"
                class="toggle-password"
                (click)="showPassword.set(!showPassword())">
                <svg *ngIf="!showPassword()" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                <svg *ngIf="showPassword()" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                  <line x1="1" y1="1" x2="23" y2="23"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="form-group">
            <label for="confirmPassword">Confirmer le mot de passe</label>
            <div class="input-wrapper">
              <input
                [type]="showConfirmPassword() ? 'text' : 'password'"
                id="confirmPassword"
                [(ngModel)]="confirmPassword"
                name="confirmPassword"
                placeholder="Confirmez votre mot de passe"
                required
                [disabled]="isLoading()">
              <button
                type="button"
                class="toggle-password"
                (click)="showConfirmPassword.set(!showConfirmPassword())">
                <svg *ngIf="!showConfirmPassword()" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                <svg *ngIf="showConfirmPassword()" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                  <line x1="1" y1="1" x2="23" y2="23"/>
                </svg>
              </button>
            </div>
          </div>

          <button type="submit" class="submit-btn" [disabled]="isLoading()">
            <span *ngIf="!isLoading()">Réinitialiser le mot de passe</span>
            <span *ngIf="isLoading()">Réinitialisation...</span>
          </button>
        </form>
      </div>

      <!-- Step 4: Success -->
      <div *ngIf="currentStep() === 'success'" class="success-container">
        <div class="success-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#66bb6a" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
        </div>
        <h2 class="success-title">Mot de passe réinitialisé!</h2>
        <p class="success-description">
          Votre mot de passe a été modifié avec succès. Vous allez être redirigé vers la page de connexion...
        </p>
      </div>
    </div>
  </div>
</div>
